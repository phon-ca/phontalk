<?xml version="1.0" encoding="UTF-8"?>

<!-- 
Comment
Schema - http://www.talkbank.org/software/talkbank
XPath -	/xs:schema/xs:complexType[@name="commentType"]
		/xs:schmea/xs:element[@name="comment"]
-->
<chunk xmlns="https://www.phon.ca/ns/chunk">
    
    <!-- Parser -->
    <buffer name="Chat.g">
        <![CDATA[
comment
	:	COMMENT_START COMMENT_ATTR_TYPE? TEXT* COMMENT_END 
	->	^(COMMENT_START COMMENT_ATTR_TYPE? TEXT*)
	;
]]>
    </buffer>
    
    <!-- Tree Walker -->
    <buffer name="ChatTree.g">
        <![CDATA[
comment returns [Comment comment]
	:	^(COMMENT_START type=COMMENT_ATTR_TYPE? vals+=TEXT*)
	{
		$comment.comment = sessionFactory.createComment();
		// if the comment is a date,
		// set the date in the session (overrides CHAT attribute)
		if($type != null && $type.text.equals("Date")) {
			// do nothing
		} else {
			// create a new comment in the transcript
			String text = "";
			if($vals != null) {
				for(int i = 0; i < $vals.size(); i++) {
					text += $vals.get(i).toString();
				}
			}
			$comment.comment.setValue(text);
			

			if($type != null)
			{
				CommentEnum cType =
					CommentEnum.fromString($type.text);
				if(cType == null)
					cType = CommentEnum.Generic;
				$comment.comment.setType(cType);
			}
		}
	}
	;
]]>
    </buffer>
	
	<buffer name="Phon2XmlWalker.g">
		<![CDATA[
comment
	:	^(COMMENT_START ctype=COMMENT_ATTR_TYPE? vals+=TEXT*)
	->	template(
			type={$ctype.text},
			vals={$vals}
		)
	<<\<comment type="<type>"\><vals>\</comment\> >>
	;
]]>
	</buffer>
	
    
</chunk>
