<?xml version="1.0" encoding="UTF-8"?>

<!-- 
Group Annotation
XPath - /xs:schema/xs:element[@name="ga"]
-->
<chunk xmlns="http://phon.ling.mun.ca/ns/chunk">
    
    <!-- Parser -->
    <buffer name="Chat.g">
        <![CDATA[
ga
	:	GA_START GA_ATTR_TYPE? TEXT? GA_END
	->	^(GA_START GA_ATTR_TYPE? TEXT?)
	;
]]>

    </buffer>
    
    <!-- Tree Walker -->
    <buffer name="ChatTree.g">
        <![CDATA[
ga returns [String val]
@init{
	$val = "";
}
	:	^(GA_START type=GA_ATTR_TYPE? v=TEXT?)
	{
		final StringBuffer buffer = new StringBuffer();
		if($type != null)
		{
		    String t = $type.text;
		    if(t.equals("actions")) {
		        buffer.append("\045act:");
		    } else if(t.equals("alternative")) {
		        buffer.append("=?");
		    } else if(t.equals("comments")) {
		        buffer.append("\045");
		    } else if(t.equals("explanation")) {
		        buffer.append("=");
		    } else if(t.equals("paralinguistics")) {
		        buffer.append("=!");
		    } else if(t.equals("standard for dialect")) {
		        buffer.append("\045sdi:");
		    } else if(t.equals("standard for child")) {
		        buffer.append("\045sch:");
		    } else if(t.equals("standard for unclear source")) {
		        buffer.append("\045xxx:");
		    }
		}

		if($v != null)
		{
			buffer.append(" " + $v.text);
		}
		
		// escape parenthesis
		$val = "(" + EscapeUtils.escapeParenthesis(buffer.toString()) + ")";
	}
	;
]]>
    </buffer>
    
    <buffer name="Phon2XmlWalker.g">
        <![CDATA[
ga
	:	^(GA_START GA_ATTR_TYPE? TEXT?)
	->    template(
	        type={$GA_ATTR_TYPE.text},
	        val={EscapeUtils.unescapeParenthesis($TEXT.text)}
	      )
	<<\<ga type="<type>"\><val>\</ga\> >>
	;
]]>

    </buffer>
    
</chunk>
